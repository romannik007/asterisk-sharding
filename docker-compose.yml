version: '3.4'
services:
 
    kamailio:
      build:
        context: ./
        dockerfile: Dockerfile.kamailio
      #depends_on:
        #- asterisk1
        #- asterisk2
      volumes:
        - ./conf/kamailio/etc/dispatcher.list:/etc/kamailio/dispatcher.list
        - ./conf/kamailio/etc/kamailio.cfg:/etc/kamailio/kamailio.cfg
      network_mode: "host"

    asterisk1:
      image: asterisk
      #container_name: asterisk
      hostname: asterisk1
      #ports:
        #- 5060:5060/tcp
        #- 5060:5060/udp
        #- 10000-10100:10000-10100/udp
        #- 10000-10100:10000-10100/tcp
      networks:
        asterisk:
          ipv4_address: 172.16.16.2
      #restart: always
      volumes:
        - ./conf/asterisk/default/asterisk:/etc/default/asterisk
        - ./conf/asterisk/asterisk:/etc/asterisk
#        - "/home/asterisk/asterisk/modules.conf:/etc/asterisk/modules.conf"
#        - "/home/asterisk/asterisk/sip.conf:/etc/asterisk/sip.conf"
        - ./logs/asterisk:/var/log/asterisk"
        - asterisk-var:/var/lib/asterisk/
        #- "/home/odbc/odbc.ini:/etc/odbc.ini"
        #- "/home/odbc/odbcinst.ini:/etc/odbcinst.ini"
      #command: "wait-for-it 192.168.0.99:3306 -s -t 20 -- asterisk -fvvvvv"
      command: ["asterisk", "-fvvvvv"]
#      entrypoint: "asterisk -fvvv"
#      command: "service asterisk start"
#      command: "asterisk -cg"
#      links:
#        - mysql
      #network_mode: "host"

    asterisk2:
      image: asterisk
      #container_name: asterisk
      hostname: asterisk2
      #restart: always
      #ports:
      #  - 5060:5060/tcp
      #  - 5060:5060/udp
      #  - 10000-10200:10000-10200/udp
      #  - 10000-10200:10000-10200/tcp
      networks:
        asterisk:
          ipv4_address: 172.16.16.3
      volumes:
        - ./conf/asterisk/default/asterisk:/etc/default/asterisk
        - ./conf/asterisk/asterisk:/etc/asterisk
#        - "/home/asterisk/asterisk/modules.conf:/etc/asterisk/modules.conf"
#        - "/home/asterisk/asterisk/sip.conf:/etc/asterisk/sip.conf"
        - ./logs/asterisk:/var/log/asterisk"
        - asterisk-var:/var/lib/asterisk/
        #- "/home/odbc/odbc.ini:/etc/odbc.ini"
        #- "/home/odbc/odbcinst.ini:/etc/odbcinst.ini"
      #command: "wait-for-it 192.168.0.99:3306 -s -t 20 -- asterisk -fvvvvv"
      command: ["asterisk", "-fvvvvv"]
#      entrypoint: "asterisk -fvvv"
#      command: "service asterisk start"
#      command: "asterisk -cg"
#      links:
#        - mysql
      #network_mode: "host"

networks: 
  asterisk:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: 172.16.16.0/24

volumes:
  asterisk-var: